{% extends 'base.html' %}

{% block scripts %}
<script src="{{STATIC_URL}}js/jquery-latest.min.js"></script> 
<!-- styles needed by jScrollPane -->
<link type="text/css" href="{{STATIC_URL}}css/jquery.jscrollpane.css" rel="stylesheet" media="all" />

<!-- the mousewheel plugin - optional to provide mousewheel support -->
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.mousewheel.js"></script>

<!-- the jScrollPane script -->
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.jscrollpane.min.js"></script>

<LINK rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/style.css"></LINK>

<script type="text/javascript">
    $(function()
    {
        $('.scroll-pane').jScrollPane();

        $(window).scroll(function(){            
            /*console.log("start")
            console.log("scrolltop [" + $(window).scrollTop()+"]")
            console.log("docscrollheight [" +document.body.scrollHeight+"]")
            console.log("discrolltop [" +$('#searchresults').scrollTop()+ "]")
            console.log("divheight [" +$('#searchresults').height()+ "]")
            console.log("clHeight [" +document.documentElement.clientHeight+ "]")
            //document.body.scrollHeight - $(this).scrollTop()  <= $(this).height()
            console.log("end")*/
        });
        
        $('#myButton').click(function()
        {
            $('div#loadmoreajaxloader').show();
            $.ajax({
            url: "/ajaxsearch?{{querystring}}&offset=20",
            success: function(html)
            {
                console.log(html);
                if(html)
                {
                    $("#searchresults").append(html);
                    $('div#loadmoreajaxloader').hide();
                }else
                {
                    $('div#loadmoreajaxloader').html('<center>No more posts to show.</center>');
                }
            }
            });
        });
    });
</script>
{% endblock scripts %}

{% block content %}
<div style="background:#9E9898">

<form method="get" action="/search">
    <table>
        <tbody>
            {{ form.as_p }}
            <tr>
                <td>&nbsp;</td>
                <td><input type="submit" value="Search"></td>
            </tr>
        </tbody>
    </table>
</form>

{% if branch_facet_selected  %}
<a href="{{ request.get_full_path }}&amp;branch_facet=">{{ branch_facet_selected }} X </a>
{% endif %}
<br>
{% if year_facet_selected  %}
<a href="{{ request.get_full_path }}&amp;year_of_passing_facet=">{{ year_facet_selected }} X </a>
{% endif %}

<div style="float:left; width:20%; background:#9E9898">
    <dl id="branch_facet">
        {% if facets.fields.branch %}
            <dt>Branch</dt>
            {# Provide only the top 5 branchs #}
            {% for branch in facets.fields.branch %}
                {% if branch.1 %}
                    {% if branch.0 == branch_facet_selected %}
                        <dd><a href="{{ request.get_full_path }}&amp;branch_facet={{ branch.0|urlencode }}">{{ branch.0 }}</a> ({{ branch.1 }}) -- selected</dd>
                    {% else %}
                        <dd><a href="{{ request.get_full_path }}&amp;branch_facet={{ branch.0|urlencode }}">{{ branch.0 }}</a> ({{ branch.1 }})</dd>                        
                    {% endif %}
                {% else %}
                    <dd>{{ branch.0 }}({{ branch.1 }})</dd>
                {% endif %}
            {% endfor %}
        {% endif %}
    </dl>
    <dl id="yog_facet" class="scroll-pane">
        {% if facets.fields.year_of_passing %}
            <dt>year</dt>
            {# Provide only the top 5 year_of_passings #}
            {% for year_of_passing in facets.fields.year_of_passing %}
                {% if year_of_passing.1 %}
                    {% if year_of_passing.0 == year_facet_selected %}
                        <dd><a href="{{ request.get_full_path }}&amp;year_of_passing_facet={{ year_of_passing.0|urlencode }}">{{ year_of_passing.0 }}</a> ({{ year_of_passing.1 }}) -selected</dd>
                    {% else %}
                        <dd><a href="{{ request.get_full_path }}&amp;year_of_passing_facet={{ year_of_passing.0|urlencode }}">{{ year_of_passing.0 }}</a> ({{ year_of_passing.1 }})</dd>                      
                    {% endif %}
                {% else %}
                    <dd>{{ year_of_passing.0 }}({{ year_of_passing.1 }})</dd>
                {% endif %}
            {% endfor %}
        {% endif %}
    </dl>

</div>
<!-- End faceting -->
<div id="searchresults" style="float:left; width:80%; background:#9E9898">
{% for result in results %}
    <span>{{ result.name }}</span><br><br>
{% empty %}
    <p>Sorry, no results found.</p>
{% endfor %}
</div>
<div id="loadmoreajaxloader" style="display:none;"><center><img src="{{STATIC_URL}}img/ajax-loader.gif" /></center></div>
<span class="cB"></span>
</div>
<button id="myButton">Click me</button>
{% endblock content %}
