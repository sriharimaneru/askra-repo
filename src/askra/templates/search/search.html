{% extends 'base.html' %}

{% block scripts %}
<!-- styles needed by jScrollPane -->
<link type="text/css" href="{{STATIC_URL}}css/jquery.jscrollpane.css" rel="stylesheet" media="all" />

<!-- the mousewheel plugin - optional to provide mousewheel support -->
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.mousewheel.js"></script>

<!-- the jScrollPane script -->
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.jscrollpane.min.js"></script>

<script src="{{STATIC_URL}}js/jquery.masonry.min.js"></script>

<LINK rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/style.css"></LINK>

<script type="text/javascript">
    $(function()
    {
        var offset=20

        $('.scroll-pane').jScrollPane();

        /*$(window).scroll(function(){
            console.log("start")
            console.log("scrolltop [" + $(window).scrollTop()+"]")
            //console.log("docscrollheight [" +document.body.scrollHeight+"]")
            console.log("divoffsettop [" +$('#search_results').offset().top+ "]")
            console.log("divheight [" +$('#search_results').height()+ "]")
            console.log("end")
        });
        
        $('#myButton').click(function()
        {
            $('div#loadmoreajaxloader').show();
            $.ajax({
            url: "/ajaxsearch?{{querystring}}&offset="+offset.toString(),
            success: function(html)
            {
                console.log(html);
                if(html)
                {
                    $("#search_results").append(html);
                    $('div#loadmoreajaxloader').hide();
                    offset+=20
                }
                else
                {
                    $('div#loadmoreajaxloader').html('<center>No more posts to show.</center>');
                }
            }
            });
        });*/

        $('#search_results').masonry({
        // options
            itemSelector : '.result_div',
        });
    });

</script>

{% endblock scripts %}

{% block content %}
<div id="search-content" class="section-content">
<h2 class="section-title">We just started and this is a sample we are planning to do We just started and this is a sample of what we are planning to do</h2>    

<form id="search_form" action="/search" method="get">
    {{ form.non_field_errors }}
    <div id="name_div" class="fieldWrapper left">
        {{ form.name.errors }}
        <label for="id_name">Name</label>
        {{ form.name }}
    </div>
    <div class="fieldWrapper left">
        {{ form.branch.errors }}
        <label for="id_branch">Branch</label>
        {{ form.branch }}
    </div>
    <div id="year_div" class="fieldWrapper left">
        {{ form.year_of_passing.errors }}
        <label for="id_year_of_passing">Year of Passing</label>
        {{ form.year_of_passing }}
    </div>
    <p class="search_submit"><input class="search_submit" class="left" type="submit" value="Search" /></p>
    <span class="cB"></span>

</form>

<div id="facet-list" class="left">
    <dl id="branch_facet">
        {% if facets.fields.branch %}
            <dt>Branch</dt>
            {% for branch in facets.fields.branch %}
                {% if branch.1 %}
                    {% if branch.0 == branch_facet_selected %}
                        <dd><a class="selected_facet" href="{{ request.get_full_path }}&amp;branch_facet={{ branch.0|urlencode }}">{{ branch.0 }}</a> ({{ branch.1 }})</dd>
                    {% else %}
                        <dd><a href="{{ request.get_full_path }}&amp;branch_facet={{ branch.0|urlencode }}">{{ branch.0 }}</a> ({{ branch.1 }})</dd>                        
                    {% endif %}
                {% else %}
                    <dd>{{ branch.0 }}({{ branch.1 }})</dd>
                {% endif %}
            {% endfor %}
        {% endif %}
    </dl>
    <dl id="yog_facet" class="scroll-pane">
        {% if facets.fields.year_of_passing %}
            <dt>year</dt>
            {% for year_of_passing in facets.fields.year_of_passing %}
                {% if year_of_passing.1 %}
                    {% if year_of_passing.0 == year_facet_selected %}
                        <dd><a class="selected_facet" href="{{ request.get_full_path }}&amp;year_of_passing_facet={{ year_of_passing.0|urlencode }}">{{ year_of_passing.0 }}</a> ({{ year_of_passing.1 }})</dd>
                    {% else %}
                        <dd><a href="{{ request.get_full_path }}&amp;year_of_passing_facet={{ year_of_passing.0|urlencode }}">{{ year_of_passing.0 }}</a> ({{ year_of_passing.1 }})</dd>                      
                    {% endif %}
                {% else %}
                    <dd>{{ year_of_passing.0 }}({{ year_of_passing.1 }})</dd>
                {% endif %}
            {% endfor %}
        {% endif %}
    </dl>
    <dl id="city_facet" class="scroll-pane">
        {% if facets.fields.city %}
            <dt>City</dt>
            {% for city in facets.fields.city %}
                {% if city.1 %}
                    {% if city.0 == city_facet_selected %}
                        <dd><a class="selected_facet" href="{{ request.get_full_path }}&amp;city_facet={{ city.0|urlencode }}">{{ city.0 }}</a> ({{ city.1 }})</dd>
                    {% else %}
                        <dd><a href="{{ request.get_full_path }}&amp;city_facet={{ city.0|urlencode }}">{{ city.0 }}</a> ({{ city.1 }})</dd>                      
                    {% endif %}
                {% else %}
                    <dd>{{ city.0 }}({{ city.1 }})</dd>
                {% endif %}
            {% endfor %}
        {% endif %}
    </dl>
</div>

<div id="search_results_panel" class="left">
    <div id="search_results_header">
        <div id="applied_facets" class="left">
            {% if branch_facet_selected  %}
                <a class="remove_facet" href="{{ request.get_full_path }}&amp;branch_facet=">{{ branch_facet_selected }} X </a>
            {% endif %}
            {% if year_facet_selected  %}
                <a class="remove_facet" href="{{ request.get_full_path }}&amp;year_of_passing_facet=">{{ year_facet_selected }} X </a>
            {% endif %}
            {% if city_facet_selected  %}
                <a class="remove_facet" href="{{ request.get_full_path }}&amp;city_facet=">{{ city_facet_selected }} X </a>
            {% endif %}
        </div>
        <div id="num_results" class="right">
            <p>Number of results : {{resultcount}}</p>
        </div>
        <p class="cB"></p>
    </div>
    <div id="search_results">
        {% for result in results %}
            <div class="result_div">
                <h2 class="name section-subtitle">{{ result.name}}</h2>    
                <p class="branch">{{ result.branch}}</p>    
                <p class="year_of_passing">{{ result.year_of_passing}}</p>    
                <p class="city">{{ result.city}}</p>    
            </div>
        {% empty %}
            <p>Sorry, no results found.</p>
        {% endfor %}
    </div>
</div>
<!--<div id="loadmoreajaxloader" style="display:none;"><center><img src="{{STATIC_URL}}img/ajax-loader.gif" /></center></div>
<button id="myButton">Click me</button>-->
</div>
<p class="cB"></p>
{% endblock content %}
